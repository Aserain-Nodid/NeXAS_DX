# BSDX SPM HitBox 反向记录

本文件用于整理 `src/main/resources/spmJson` 中解析得到的 BSDX 版 SPM 命中区域（`hitRects`）字段表现，为后续从 BHE → BSDX 的转换提供参考。统计与样本均来自 导出的全量 JSON。

## 全量统计

- 数据总量：共 188,628 条 `hitRect` 记录。
- `unk0` 分布：
  | unk0 | 条数 | 占比 |
  |-----:|-----:|-----:|
  | 0 | 1,624 | 0.86% |
  | 1 |   859 | 0.46% |
  | 2 | 178,195 | 94.45% |
  | 3 |   666 | 0.35% |
  | 4 | 2,211 | 1.17% |
  | 5 |   977 | 0.52% |
  | 6 |   603 | 0.32% |
  | 7 | 3,493 | 1.85% |

- `unk1` 取值范围：-224 ~ 268（多为 8 的倍数）。
- `unk2` 取值范围：0 ~ 288（同样常见 8 的倍数）。
- 在 `unk0 = 0~6` 的命中体中，`unk1` 与 `unk2` 几乎恒为 0；只有 `unk0 = 7` 的命中体大量出现非零的 (`unk1`, `unk2`) 组合，如 (16, 128)。

> 推测：
> - `unk0` 是碰撞用途的枚举值，决定判定归类（主判定、弱判定、特效判定等）。
> - `unk1`/`unk2` 更像是附加参数，用于描述深度/高度范围或其他特性；目前只有类型 7 会设置明显的厚度。

## 各类型样本

以下示例均取自 `src/main/resources/spmJson` 中的实际记录，展示典型的矩形范围与 `unk1/unk2` 取值。

### unk0 = 0 —— 末端小判定
- 文件：`chinatsu.spm.json`
- 例：`page 896, hit 0`
```json
{"hitRect":{"left":23,"top":-4,"right":27,"bottom":0},"unk0":0,"unk1":0,"unk2":0}
```
这些矩形尺寸很小，多数贴合手脚末端或武器尖端。

### unk0 = 1 —— 角色整体框
- 文件：`chinatsu_past.spm.json`
- 例：`page 928, hit 0`
```json
{"hitRect":{"left":-8,"top":24,"right":24,"bottom":56},"unk0":1,"unk1":0,"unk2":0}
```
常用来描述角色身体的整体包围盒，矩形较大且覆盖范围稳定。

### unk0 = 2 —— 常规攻击判定（最多）
- 文件：`bomb.spm.json`
- 例：`page 0, hit 0`
```json
{"hitRect":{"left":-8,"top":-8,"right":8,"bottom":8},"unk0":2,"unk1":0,"unk2":0}
```
绝大多数命中体属于该类，推测是普通攻击/受击判定。

### unk0 = 3 —— 环绕式护罩
- 文件：`chinatsu_past.spm.json`
- 例：`page 680, hit 0`
```json
{"hitRect":{"left":-48,"top":40,"right":48,"bottom":136},"unk0":3,"unk1":0,"unk2":0}
```
常见于角色周围分布的多块矩形，似乎形成一圈“环形护罩”。

### unk0 = 4 —— 大型区域
- 文件：`chinatsu.spm.json`
- 例：`page 952, hit 0`
```json
{"hitRect":{"left":-32,"top":24,"right":32,"bottom":88},"unk0":4,"unk1":0,"unk2":0}
```
矩形更大、覆盖范围更广，可能用于特殊攻击或判定层级更高的伤害。

### unk0 = 5 —— 远离本体的大矩形
- 文件：`chinatsu.spm.json`
- 例：`page 1544, hit 0`
```json
{"hitRect":{"left":-48,"top":-136,"right":48,"bottom":-40},"unk0":5,"unk1":0,"unk2":0}
```
这些矩形经常位于角色身体之外，推测是远程攻击或抛射物判定。

### unk0 = 6 —— 连续小矩形
- 文件：`chinatsu.spm.json`
- 例：`page 793, hit 0~2`
```json
{"hitRect":{"left":-40,"top":-8,"right":-8,"bottom":24},"unk0":6,"unk1":0,"unk2":0}
{"hitRect":{"left":-64,"top":16,"right":-32,"bottom":48},"unk0":6,"unk1":0,"unk2":0}
{"hitRect":{"left":-88,"top":40,"right":-56,"bottom":72},"unk0":6,"unk1":0,"unk2":0}
```
呈链状分布的小矩形，可能是某些持续判定或拖尾轨迹。

### unk0 = 7 —— 具有厚度的区域
- 文件：`chinatsu_past.spm.json`
- 例：`page 808, hit 0`
```json
{"hitRect":{"left":-24,"top":-80,"right":24,"bottom":80},"unk0":7,"unk1":16,"unk2":128}
```
同一帧内常出现多个矩形，`unk1/unk2` 反复设置为 (16, 128)、(24, 144) 等值，推测代表该类型在 Z 方向的有效范围或分层厚度。

## 转换建议

1. **`unk0` 必须人工映射**：BHE 的 hitbox 结构并未提供直接的类型枚举，需要根据形状用途手动决定映射关系。可参考上表，将普通判定映射到 2，弱判定映射到 0/1，特效或护罩映射到 3/4/5/6，具有厚度的命中体映射到 7。
2. **`unk1/unk2` 先按需求写入**：除了 `unk0 = 7` 的场景，BSDX 数据几乎都是 0，可在没有明确语义之前先写 0。若后续需要 3D 体积，可将 BHE 的 Z 范围映射到这两个字段。
3. **保持灵活性**：如果后续从游戏逻辑或反编译中获取更详细的碰撞体说明，再回头调整映射或填充规则。
